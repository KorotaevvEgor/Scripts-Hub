#!/bin/bash

# Scripts Hub - –°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞
echo "=== –ó–ê–ü–£–°–ö SCRIPTS HUB ==="

cd /var/www/scriptshub/Scripts-Hub/vacancy_parser

# –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
source venv/bin/activate

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –Ω–µ –∑–∞–ø—É—â–µ–Ω –ª–∏ —É–∂–µ —Å–µ—Ä–≤–µ—Ä
if netstat -tlnp | grep :8000 > /dev/null; then
    echo "‚ö†Ô∏è  –°–µ—Ä–≤–µ—Ä —É–∂–µ –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 8000"
    echo "–î–ª—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ stop_server.sh, –∑–∞—Ç–µ–º start_server.sh"
    exit 1
fi

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä –≤ —Ñ–æ–Ω–µ
echo "üöÄ –ó–∞–ø—É—Å–∫ Django —Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞ http://89.111.173.103:8000/"
nohup python manage.py runserver 0.0.0.0:8000 > server.log 2>&1 &

# –ü–æ–¥–æ–∂–¥–∞—Ç—å –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–ø—É—Å–∫
sleep 3
if netstat -tlnp | grep :8000 > /dev/null; then
    echo "‚úÖ –°–µ—Ä–≤–µ—Ä —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—â–µ–Ω!"
    echo ""
    echo "üì± –î–æ—Å—Ç—É–ø–Ω—ã–µ —Å—Å—ã–ª–∫–∏:"
    echo "   –û—Å–Ω–æ–≤–Ω–æ–π —Å–∞–π—Ç:    http://89.111.173.103:8000/"
    echo "   –ê–¥–º–∏–Ω–∫–∞:          http://89.111.173.103:8000/admin/"
    echo ""
    echo "üë§ –î–∞–Ω–Ω—ã–µ –¥–ª—è –≤—Ö–æ–¥–∞:"
    echo "   –ê–¥–º–∏–Ω:            admin / admin"
    echo "   –¢–µ—Å—Ç–æ–≤—ã–π —é–∑–µ—Ä:    testuser / testpass123"
    echo ""
    echo "üìã –õ–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞:     tail -f server.log"
    echo "üõë –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å:       ./stop_server.sh"
else
    echo "‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: cat server.log"
fi
